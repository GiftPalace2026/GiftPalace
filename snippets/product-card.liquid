{% comment %}
    Renders a product card

    Accepts:
    - product_card_product: {Object} Product Liquid object (optional)
    - media_size: {String} Size of the product image card. Values are "square" and "portrait". Default is "square" (optional)
    - show_secondary_image: {Boolean} Show the secondary image on hover. Default: false (optional)
    - add_image_padding: {Boolean} Enables padding on the image to space out the grid
    - show_vendor: {Boolean} Show the product vendor. Default: false

    Usage:
    {% render 'product-card', show_vendor: section.settings.show_vendor %}
{% endcomment %}

{%- liquid
    assign product_swatch_option = settings.swatch | downcase
    assign isColor = false
    assign variant_img = ''
    for option in product_card_product.options_with_values
        assign option_name = option.name | downcase
        if product_swatch_option contains option_name
            assign isColor = true
            assign index = forloop.index0
            assign position = forloop.index | minus: 1
            assign variant_selected = option.selected_value
            if settings.show_quick_shop
                for variant in product_card_product.variants limit: 1
                    if variant.image != null  
                        assign variant_img = variant.image
                    endif
                endfor
            endif
          break
        else 
            assign position = 0
            assign variant_selected = nil
        endif
    endfor

    assign media_size = settings.product_block_image_ratio
    if media_size == 'portrait'
        assign portrait_aspect_ratio = settings.portrait_height
    endif 

    assign featured_media_aspect_ratio = product_card_product.featured_media.aspect_ratio
    if product_card_product.featured_media.aspect_ratio == nil
        assign featured_media_aspect_ratio = 1
    endif

    assign product_action_group = false
    
    assign show_quick_view = false
    if settings.show_quick_view 
        if settings.product_quick_view_type == 'icon' or settings.show_quick_view_mb
            assign show_quick_view = true
        endif
    endif

    assign show_wishlist = false
    if settings.show_wishlist_card and settings.show_wishlist
        assign show_wishlist = true
    endif

    assign show_compare = false
    if settings.show_compare and settings.product_compare_type == 'icon'
        assign show_compare = true
    endif

    if show_quick_view or show_wishlist or show_compare
        assign product_action_group = true
    endif

    assign has_video = product_card_product.media | where: 'media_type','video'

    assign show_price = settings.show_price
-%}
<div class="product-item{% if settings.enable_background_button_card %} enable_background_button_card{% endif %}" data-product-id="{{ product_card_product.id }}" data-json-product='{"id": {{product_card_product.id}},"handle": "{{product_card_product.handle}}","media": {{product.media | json | escape}},"variants": {{ product_card_product.variants | json | escape}}}'>
    <div class="card">
        <div class="card-product{% if product_card_product.featured_media == nil %} card--text-only card--soft{% endif %}">
            <div class="card-product__wrapper">
                {%- if settings.show_badge -%}
                    {% render 'product-badge',
                        product: product_card_product,
                        class: 'card__badge',
                        badge_detail: true,
                        serial: serial
                    %}
                {%- endif -%}
                <div class="card-media card-media--{{ media_size }}{% if product_card_product.media[1] != nil and settings.show_image_swap %} media--hover-effect{% endif%}{% if settings.show_compare and settings.product_compare_type == 'default' %} has-compare{% endif %}{% if loading %} media--loading-effect{% endif %}"
                    {% if product_card_product.featured_media %}
                        {% if media_size == 'adapt' %}
                            style="padding-bottom: {{ 1 | divided_by: featured_media_aspect_ratio | times: 100 }}%;"
                        {% elsif media_size == 'square' %}
                            style="padding-bottom: 100%;"
                        {% elsif media_size == 'portrait' %}
                            {% if portrait_aspect_ratio != blank %}
                                style="padding-bottom: {{ portrait_aspect_ratio | append: '%' }};"
                            {% endif %}
                        {% endif %}
                    {% endif %}
                >
                    {% render 'image-product-card',
                        product_card_product: product_card_product,
                        variant_img: variant_img,
                        has_video: has_video,
                        loading: loading
                    %}
                    <a class="card-link" href="{{ product_card_product.url }}" title="{{ product_card_product.title | escape }}"></a>
                </div>

                {%- if product_action_group -%}
                    <div class="card-product__group group-{{ settings.group_quickview_wishlist }}">
                        {%- if show_wishlist -%}
                            <div class="card-product__group-item card-wishlist">
                                <button type="button" title="{{ 'wishlist.general.add' | t }}" class="wishlist-icon{% if settings.show_wishlist_card_mb %} show-mb{% endif %}" data-wishlist data-wishlist-handle="{{ product_card_product.handle }}" data-product-id="{{ product_card_product.id }}">
                                    <span class="visually-hidden">{{ 'wishlist.general.add' | t }}</span>
                                    <span class="text">
                                        {{ 'wishlist.general.add' | t }}
                                    </span>
                                    {% render 'icon-heart-2' %}
                                </button>
                            </div>
                        {%- endif -%}
                        {%- if show_quick_view -%}
                            <div class="card-product__group-item card-quickview card-quickviewIcon{% if settings.show_quick_view_mb %} show-mb{% endif %}{% if settings.product_quick_view_type == 'default' %} default{% endif %}">
                                <button type="button" title="{{ 'products.product.quick_view' | t }}" class="quickview-icon" data-product-id="{{ product_card_product.id }}" data-open-quick-view-popup data-product-handle="{{ product_card_product.handle }}">
                                    <span class="visually-hidden">{{ 'products.product.quick_view' | t }}</span>
                                    <span class="text">
                                        {{ 'products.product.quick_view' | t }}
                                    </span>
                                    {% render 'icon-eyes' %}
                                </button>
                            </div>
                        {%- endif -%}
                        {%- if show_compare -%}
                            {% render 'product-compare',
                                product: product_card_product,
                                sectionId: sectionId,
                                class: 'card-product__group-item card-compare card-compareIcon'
                            %}
                        {%- endif -%}
                    </div>
                {%- endif -%}

                 {% if settings.display_item_size %}
                    {% render 'product-item-size', product: product_card_product %}
                {% endif %}

                {%- if settings.show_quick_view and settings.product_quick_view_type == 'default' -%}
                    <div class="card-quickview">
                        <button type="button" title="{{ 'products.product.quick_view' | t }}" class="quickview-button button" data-product-id="{{ product_card_product.id }}" data-open-quick-view-popup data-product-handle="{{ product_card_product.handle }}">
                            <span class="visually-hidden">{{ 'products.product.quick_view' | t }}</span>
                            {{ 'products.product.quick_view' | t }}
                        </button>
                    </div>
                {%- endif -%}

                {%- if settings.show_action -%}
                    <div class="card-action{% if settings.show_compare and settings.product_compare_type == 'default' %} has-compare{% endif %}">
                        {% render 'add-to-cart-form',
                            product: product_card_product,
                            id: 'form',
                            position: position,
                            sectionId: sectionId
                        %}
                    </div>
                {%- endif -%}

                {%- if settings.show_compare and settings.product_compare_type == 'default' -%}
                    {% render 'product-compare',
                        product: product_card_product,
                        sectionId: sectionId,
                        class: 'card-compare'
                    %}
                {%- endif -%}
                    
                {%- if settings.show_product_marquee -%}
                    {% render 'product-card-marquee',
                        product: product_card_product,
                    %}  
                {%- endif -%}
            </div>
        </div>
        <div class="card-information">
            <div class="card-information__wrapper text-{{ settings.product_content_text_align }}">
                {%- if settings.show_vendor -%}
                    <div class="card-information__group card-information__group-2">
                        <div class="card-vendor">
                            <span class="visually-hidden">{{ 'accessibility.vendor' | t }}</span>
                            {{ product_card_product.vendor | link_to_vendor }}
                        </div>
                    </div>
                {%- endif -%}
               
                <a class="card-title link-underline{% if settings.product_title_line_text != 'full' %} card-title-ellipsis{% endif %}{% if variant_selected != blank %} card-title-change{% endif %}" href="{{ product_card_product.url }}" data-product-title="{{ product_card_product.title | escape }}" data-product-url="{{ product_card_product.url }}">
                    <span class="text">
                        {{ product_card_product.title | escape }}
                        {% if variant_selected != blank %}
                            <span data-change-title> {% unless settings.quick_shop_type == '2' %}{% if settings.style_text_color_varriant == '01' %}-{% endif %} {{ variant_selected }}{% endunless %}</span>
                        {% endif %}
                    </span>
                </a>
                </a>
                {% assign subheading = product_card_product.metafields.custom.subheading %}
                {% if subheading == blank %}
                  {% assign subheading = product_card_product.metafields.custom.product_subheading %}
                {% endif %}

                {%- comment -%} Celestial Heirlooms Zodiac Signs {%- endcomment -%}
                {% assign product_title_downcase = product_card_product.title | downcase %}
                {% assign show_zodiac = false %}
                {% assign zodiac_sign = '' %}
                {% assign zodiac_dates = '' %}

                {% if product_title_downcase contains 'aries' %}
                  {% assign show_zodiac = true %}
                  {% assign zodiac_sign = '♈ Aries' %}
                  {% assign zodiac_dates = 'March 21 to April 19' %}
                {% elsif product_title_downcase contains 'taurus' %}
                  {% assign show_zodiac = true %}
                  {% assign zodiac_sign = '♉ Taurus' %}
                  {% assign zodiac_dates = 'April 20 to May 20' %}
                {% elsif product_title_downcase contains 'gemini' %}
                  {% assign show_zodiac = true %}
                  {% assign zodiac_sign = '♊ Gemini' %}
                  {% assign zodiac_dates = 'May 21 to June 20' %}
                {% elsif product_title_downcase contains 'cancer' %}
                  {% assign show_zodiac = true %}
                  {% assign zodiac_sign = '♋ Cancer' %}
                  {% assign zodiac_dates = 'June 21 to July 22' %}
                {% elsif product_title_downcase contains 'leo' %}
                  {% assign show_zodiac = true %}
                  {% assign zodiac_sign = '♌ Leo' %}
                  {% assign zodiac_dates = 'July 23 to August 22' %}
                {% elsif product_title_downcase contains 'virgo' %}
                  {% assign show_zodiac = true %}
                  {% assign zodiac_sign = '♍ Virgo' %}
                  {% assign zodiac_dates = 'August 23 to September 22' %}
                {% elsif product_title_downcase contains 'libra' %}
                  {% assign show_zodiac = true %}
                  {% assign zodiac_sign = '♎ Libra' %}
                  {% assign zodiac_dates = 'September 23 to October 22' %}
                {% elsif product_title_downcase contains 'scorpio' %}
                  {% assign show_zodiac = true %}
                  {% assign zodiac_sign = '♏ Scorpio' %}
                  {% assign zodiac_dates = 'October 23 to November 21' %}
                {% elsif product_title_downcase contains 'sagittarius' %}
                  {% assign show_zodiac = true %}
                  {% assign zodiac_sign = '♐ Sagittarius' %}
                  {% assign zodiac_dates = 'November 22 to December 21' %}
                {% elsif product_title_downcase contains 'capricorn' %}
                  {% assign show_zodiac = true %}
                  {% assign zodiac_sign = '♑ Capricorn' %}
                  {% assign zodiac_dates = 'December 22 to January 19' %}
                {% elsif product_title_downcase contains 'aquarius' %}
                  {% assign show_zodiac = true %}
                  {% assign zodiac_sign = '♒ Aquarius' %}
                  {% assign zodiac_dates = 'January 20 to February 18' %}
                {% elsif product_title_downcase contains 'pisces' %}
                  {% assign show_zodiac = true %}
                  {% assign zodiac_sign = '♓ Pisces' %}
                  {% assign zodiac_dates = 'February 19 to March 20' %}
                {% endif %}

                {%- comment -%} Bracelet Subheadings {%- endcomment -%}
                {% assign product_type_downcase = product_card_product.product_type | downcase %}
                {% assign show_bracelet_info = false %}
                {% assign bracelet_info = '' %}

                {% if product_type_downcase contains 'bracelet' or product_title_downcase contains 'bracelet' %}
                  {% assign show_bracelet_info = true %}
                  {%- comment %} Extract size if present in title {%- endcomment -%}
                  {% if product_title_downcase contains '6 inch' or product_title_downcase contains '6"' %}
                    {% assign bracelet_info = '6" Size' %}
                  {% elsif product_title_downcase contains '7 inch' or product_title_downcase contains '7"' %}
                    {% assign bracelet_info = '7" Size' %}
                  {% elsif product_title_downcase contains '8 inch' or product_title_downcase contains '8"' %}
                    {% assign bracelet_info = '8" Size' %}
                  {% elsif product_title_downcase contains '6.5 inch' or product_title_downcase contains '6.5"' %}
                    {% assign bracelet_info = '6.5" Size' %}
                  {% elsif product_title_downcase contains '6-7 inch' or product_title_downcase contains '6-7"' %}
                    {% assign bracelet_info = 'Adjustable 6-7"' %}
                  {% elsif product_title_downcase contains '7-8 inch' or product_title_downcase contains '7-8"' %}
                    {% assign bracelet_info = 'Adjustable 7-8"' %}
                  {% endif %}

                  {%- comment %} Add material to bracelet info {%- endcomment -%}
                  {% if product_title_downcase contains 'gold' %}
                    {% if bracelet_info != '' %}
                      {% assign bracelet_info = bracelet_info | append: ' | 14K Gold' %}
                    {% else %}
                      {% assign bracelet_info = '14K Gold Plated' %}
                    {% endif %}
                  {% elsif product_title_downcase contains 'rose gold' %}
                    {% if bracelet_info != '' %}
                      {% assign bracelet_info = bracelet_info | append: ' | Rose Gold' %}
                    {% else %}
                      {% assign bracelet_info = 'Rose Gold Plated' %}
                    {% endif %}
                  {% elsif product_title_downcase contains 'silver' %}
                    {% if bracelet_info != '' %}
                      {% assign bracelet_info = bracelet_info | append: ' | Sterling Silver' %}
                    {% else %}
                      {% assign bracelet_info = 'Sterling Silver' %}
                    {% endif %}
                  {% endif %}
                {% endif %}

                {% if show_zodiac %}
                    <div class="product-subheading card-subheading zodiac-subheading">
                        {{ zodiac_dates }}
                    </div>
                {% elsif show_bracelet_info and bracelet_info != blank %}
                    <div class="product-subheading card-subheading bracelet-subheading">
                        {{ bracelet_info }}
                    </div>
                {% elsif subheading != blank %}
                    <div class="product-subheading card-subheading">
                        {{ subheading }}
                    </div>
                {% endif %}




              <!-- Start of Judge.me code --> 
      <div style='{{ jm_style }}' class='jdgm-widget jdgm-preview-badge' data-id='{{ product.id }}' data-auto-install='false'>
        {{ product.metafields.judgeme.badge }}
      </div>  
      <!-- End of Judge.me code -->
              
                {%- if settings.show_review -%}
                    <div class="card-review clearfix halo-productReview">
                        <span class="shopify-product-reviews-badge" data-id="{{ product_card_product.id }}"></span>
                    </div>
                {%- endif -%}

                {% render 'product-card-summary',
                    product: product_card_product,
                    class: 'card-list__hidden'
                %}

                {%- if show_price -%}
                    <div class="card-price">
                        {% render 'price',
                            product: product_card_product,
                            price_class: '',
                            hasCountdown: hasCountdown
                        %}
                    </div>
                {%- endif -%}
            </div>
            {%- if isColor -%}
                {%- unless settings.show_swatch -%}
                <div class="hidden">
                {%- endunless -%}
                    {% render 'product-swatch',
                        product: product_card_product,
                        index: index
                    %}
                {%- unless settings.show_swatch -%}
                </div>
                {%- endunless -%}
            {%- endif -%}

            {% if settings.display_text_size %}
                {% assign variant_size = product_card_product.options_by_name['Size'].values | size %}
                {% if variant_size > 0 %}
                    <span class="text-size text-{{ settings.product_content_text_align }}">{{ 'products.product.more_sizes' | t }}</span>
                {% endif %}
            {% endif %}

            {%- if settings.show_action -%}
                {% render 'add-to-cart-form-category-list',
                    product: product_card_product,
                    id: 'form',
                    list: 'list',
                    position: position,
                    sectionId: sectionId
                %}
            {%- endif -%}

            {%- if settings.show_compare and settings.product_compare_type == 'default' -%}
                <div class="card-compare-wrapper card-list__hidden">
                    {% render 'product-compare'.
                        product: product_card_product,
                        sectionId: sectionId,
                        check: true
                    %}
                </div>
            {%- endif -%}
        </div>
    </div>
</div>
