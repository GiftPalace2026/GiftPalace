{%- liquid
    assign media_size = settings.product_block_image_ratio
    if media_size == 'portrait'
        assign portrait_aspect_ratio = settings.portrait_height
    endif 

    assign featured_media_aspect_ratio = product.featured_media.aspect_ratio
    if product.featured_media.aspect_ratio == nil
        assign featured_media_aspect_ratio = 1
    endif

    assign product_action_group = false
    
    assign sold_out = false
    if product.available == false
        assign sold_out = true
    endif

    assign variantCount = product.variants | size
    assign option_name = product.options_with_values[0].name | downcase
    assign product_swatch_option = settings.swatch | downcase

    assign has_popup = false

    if product.options_with_values.size == 1 and product_swatch_option contains option_name and settings.quick_shop_type == '1'
        assign has_popup = false
    else
        assign has_popup = true
    endif
-%}
<div class="product-item" data-product-id="{{ product.id }}">
    <div class="card">
        <div class="card-product{% if product.featured_media == nil %} card--text-only card--soft{% endif %}">
            <div class="card-product__wrapper">
                <a class="card-media card-media--{{ media_size }}{% if settings.show_image_swap %} media--hover-effect{% endif%}"
                    href="{{ product.url | within: collection }}"
                    {% if product.featured_media %}
                        {% if media_size == 'adapt' %}
                            style="padding-bottom: {{ 1 | divided_by: featured_media_aspect_ratio | times: 100 }}%;"
                        {% elsif media_size == 'square' %}
                            style="padding-bottom: 100%;"
                        {% elsif media_size == 'portrait' %}
                            {% if portrait_aspect_ratio != blank %}
                                style="padding-bottom: {{ portrait_aspect_ratio | append: '%' }};"
                            {% endif %}
                        {% endif %}
                    {% endif %}
                >
                    {%- if product.featured_media -%}
                        {%- if variant_img != blank -%}
                            <img {% render 'lazyload',preview_img: variant_img, class: true  %} />
                        {%- else -%}
                            <img {% render 'lazyload',preview_img: product.featured_media, class: true  %} />
                        {%- endif -%}
                        {%- if product.media[1] != nil and settings.show_image_swap -%}
                            <img {% render 'lazyload',preview_img: product.media[1], class: true  %} />
                        {%- endif -%}
                        {% if settings.enable_lazyload %}<span class="data-lazy-loading"></span>{% endif %}
                    {%- else -%}
                        {% capture current %}{% cycle 1, 2, 3, 4, 5, 6 %}{% endcapture %}
                        {{ 'product-' | append: current | placeholder_svg_tag: 'placeholder-svg' }}
                    {%- endif -%}
                </a>
                {%- if settings.show_action -%}
                    <div class="card-action">
                        <form action="{{ routes.cart_url }}/add" method="post" class="variants" id="{{ id }}-{{ product.id }}-{{ sectionId }}" data-product-id="{{ product.id }}" enctype="multipart/form-data">
                            {%- if sold_out -%}
                                {%- if settings.show_notify_form -%}
                                    <a class="button button-ATC is-notify-me" href="{{ product.url }}" data-btn-addToCart>
                                        {{ 'notify_form.general.label' | t }}
                                    </a>
                                {%- else -%}
                                    <a class="button button-ATC" href="{{ product.url }}" disabled="disabled">
                                        {{ 'products.product.out_of_stock' | t }}
                                    </a>
                                {%- endif -%}
                            {%- else -%}
                                {%- if variantCount > 0 and product.variants.first.title != 'Default Title' -%}
                                    {%- if product.options_with_values.size == 1 and product_swatch_option contains option_name and settings.show_swatch and settings.quick_shop_type == '1' -%}
                                        <input type="hidden" name="id" value="{{ product.variants[0].id }}" />
                                        <input type="hidden" name="quantity" value="1" />
                                        <button
                                            class="button button-ATC"
                                            type="submit"
                                            data-form-id="#{{ id }}-{{ product.id }}-{{ sectionId }}"
                                            data-btn-addToCart
                                        >
                                            {{ 'products.product.add_to_cart' | t }}
                                        </button>
                                    {%- else -%}
                                        <a class="button button-ATC" href="{{ product.url }}">
                                            {{ 'products.product.select_options' | t }}
                                        </a>
                                    {%- endif -%}
                                {%- else -%}
                                    <input type="hidden" name="id" value="{{ product.variants[0].id }}" />
                                    <input type="hidden" name="quantity" value="1" />
                                    {%- liquid
                                        assign current_variant_grid = product.selected_or_first_available_variant
                                        assign first_inventory_grid = current_variant_grid.inventory_quantity
                                    -%}
                          
                                    {%- if first_inventory_grid > 0 -%}
                                        <button
                                            class="button button-ATC"
                                            type="submit"
                                            data-form-id="#{{ id }}-{{ product.id }}-{{ sectionId }}"
                                            data-btn-addToCart
                                        >
                                            {{ 'products.product.add_to_cart' | t }}
                                        </button>
                                    {%- else -%}
                                        <button
                                            class="button button-ATC"
                                            type="submit"
                                            data-form-id="#{{ id }}-{{ product.id }}-{{ sectionId }}"
                                            data-btn-addToCart
                                        >
                                            {{ 'products.product.pre_order' | t }}
                                        </button>
                                    {%- endif -%} 
                                {%- endif -%}
                            {%- endif -%}
                        </form>
                    </div>
                {%- endif -%}
            </div>
        </div>
        <div class="card-information">
            <div class="card-information__wrapper text-{{ settings.product_content_text_align }}">
                {%- if settings.show_vendor -%}
                    <div class="card-information__group card-information__group-2">
                        {%- if settings.show_vendor -%}
                            <div class="card-vendor">
                                <span class="visually-hidden">{{ 'accessibility.vendor' | t }}</span>
                                {{ product.vendor | link_to_vendor }}
                            </div>
                        {%- endif -%}
                    </div>
                {%- endif -%}
                <a class="card-title link-underline{% if settings.product_title_line_text != 'full' %} card-title-ellipsis{% endif %}{% if variant_selected != blank %} card-title-change{% endif %}" href="{{ product.url | within: collection }}" data-product-title="{{ product.title | escape }}" data-product-url="{{ product.url | within: collection }}">
                    <span class="text">
                        {{ product.title | escape }}
                        {% if variant_selected != blank %}
                            <span data-change-title> - {{ variant_selected }}</span>
                        {% endif %}
                    </span>
                </a>
                {%- comment -%} Celestial Heirlooms Zodiac Signs {%- endcomment -%}
                {% assign product_title_downcase = product.title | downcase %}
                {% assign show_zodiac = false %}
                {% assign zodiac_sign = '' %}
                {% assign zodiac_dates = '' %}

                {% if product_title_downcase contains 'aries' %}
                  {% assign show_zodiac = true %}
                  {% assign zodiac_sign = '♈ Aries' %}
                  {% assign zodiac_dates = 'March 21 to April 19' %}
                {% elsif product_title_downcase contains 'taurus' %}
                  {% assign show_zodiac = true %}
                  {% assign zodiac_sign = '♉ Taurus' %}
                  {% assign zodiac_dates = 'April 20 to May 20' %}
                {% elsif product_title_downcase contains 'gemini' %}
                  {% assign show_zodiac = true %}
                  {% assign zodiac_sign = '♊ Gemini' %}
                  {% assign zodiac_dates = 'May 21 to June 20' %}
                {% elsif product_title_downcase contains 'cancer' %}
                  {% assign show_zodiac = true %}
                  {% assign zodiac_sign = '♋ Cancer' %}
                  {% assign zodiac_dates = 'June 21 to July 22' %}
                {% elsif product_title_downcase contains 'leo' %}
                  {% assign show_zodiac = true %}
                  {% assign zodiac_sign = '♌ Leo' %}
                  {% assign zodiac_dates = 'July 23 to August 22' %}
                {% elsif product_title_downcase contains 'virgo' %}
                  {% assign show_zodiac = true %}
                  {% assign zodiac_sign = '♍ Virgo' %}
                  {% assign zodiac_dates = 'August 23 to September 22' %}
                {% elsif product_title_downcase contains 'libra' %}
                  {% assign show_zodiac = true %}
                  {% assign zodiac_sign = '♎ Libra' %}
                  {% assign zodiac_dates = 'September 23 to October 22' %}
                {% elsif product_title_downcase contains 'scorpio' %}
                  {% assign show_zodiac = true %}
                  {% assign zodiac_sign = '♏ Scorpio' %}
                  {% assign zodiac_dates = 'October 23 to November 21' %}
                {% elsif product_title_downcase contains 'sagittarius' %}
                  {% assign show_zodiac = true %}
                  {% assign zodiac_sign = '♐ Sagittarius' %}
                  {% assign zodiac_dates = 'November 22 to December 21' %}
                {% elsif product_title_downcase contains 'capricorn' %}
                  {% assign show_zodiac = true %}
                  {% assign zodiac_sign = '♑ Capricorn' %}
                  {% assign zodiac_dates = 'December 22 to January 19' %}
                {% elsif product_title_downcase contains 'aquarius' %}
                  {% assign show_zodiac = true %}
                  {% assign zodiac_sign = '♒ Aquarius' %}
                  {% assign zodiac_dates = 'January 20 to February 18' %}
                {% elsif product_title_downcase contains 'pisces' %}
                  {% assign show_zodiac = true %}
                  {% assign zodiac_sign = '♓ Pisces' %}
                  {% assign zodiac_dates = 'February 19 to March 20' %}
                {% endif %}

                {%- comment -%} Bracelet Subheadings with Healing Benefits {%- endcomment -%}
                {% assign product_type_downcase = product.product_type | downcase %}
                {% assign show_bracelet_info = false %}
                {% assign bracelet_info = '' %}

                {% if product_type_downcase contains 'bracelet' or product_title_downcase contains 'bracelet' %}
                  {% assign show_bracelet_info = true %}
                  {% assign healing_benefits = '' %}

                  {% if product_title_downcase contains 'rose quartz' or product_title_downcase contains 'rose-quartz' %}
                    {% assign healing_benefits = 'Love | Emotional Healing | Self-Care' %}
                  {% elsif product_title_downcase contains 'amethyst' %}
                    {% assign healing_benefits = 'Peace | Spiritual Growth | Stress Relief' %}
                  {% elsif product_title_downcase contains 'citrine' %}
                    {% assign healing_benefits = 'Abundance | Success | Positive Energy' %}
                  {% elsif product_title_downcase contains 'clear quartz' or product_title_downcase contains 'crystal quartz' %}
                    {% assign healing_benefits = 'Clarity | Healing | Energy Amplifier' %}
                  {% elsif product_title_downcase contains "tiger's eye" or product_title_downcase contains 'tigers eye' or product_title_downcase contains 'tiger eye' %}
                    {% assign healing_benefits = 'Courage | Strength | Good Luck' %}
                  {% elsif product_title_downcase contains 'obsidian' %}
                    {% assign healing_benefits = 'Protection | Grounding | Negativity Shield' %}
                  {% elsif product_title_downcase contains 'jade' %}
                    {% assign healing_benefits = 'Luck | Prosperity | Wisdom' %}
                  {% elsif product_title_downcase contains 'turquoise' %}
                    {% assign healing_benefits = 'Protection | Communication | Healing' %}
                  {% elsif product_title_downcase contains 'lapis' %}
                    {% assign healing_benefits = 'Wisdom | Truth | Inner Peace' %}
                  {% elsif product_title_downcase contains 'pyrite' %}
                    {% assign healing_benefits = 'Protection | Abundance | Confidence' %}
                  {% elsif product_title_downcase contains 'emerald' %}
                    {% assign healing_benefits = 'Love | Rebirth | Fertility' %}
                  {% elsif product_title_downcase contains 'sapphire' %}
                    {% assign healing_benefits = 'Wisdom | Spiritual Growth | Clarity' %}
                  {% elsif product_title_downcase contains 'ruby' %}
                    {% assign healing_benefits = 'Passion | Energy | Courage' %}
                  {% elsif product_title_downcase contains 'garnet' %}
                    {% assign healing_benefits = 'Protection | Energy | Commitment' %}
                  {% elsif product_title_downcase contains 'aquamarine' %}
                    {% assign healing_benefits = 'Calm | Communication | Courage' %}
                  {% elsif product_title_downcase contains 'opal' %}
                    {% assign healing_benefits = 'Creativity | Inspiration | Luck' %}
                  {% elsif product_title_downcase contains 'moonstone' %}
                    {% assign healing_benefits = 'Intuition | Feminine Energy | Balance' %}
                  {% elsif product_title_downcase contains 'hematite' %}
                    {% assign healing_benefits = 'Grounding | Focus | Strength' %}
                  {% elsif product_title_downcase contains 'howlite' %}
                    {% assign healing_benefits = 'Calm | Patience | Awareness' %}
                  {% elsif product_title_downcase contains 'amazonite' %}
                    {% assign healing_benefits = 'Truth | Communication | Balance' %}
                  {% elsif product_title_downcase contains 'coral' %}
                    {% assign healing_benefits = 'Emotional Healing | Passion | Vitality' %}
                  {% elsif product_title_downcase contains 'onyx' %}
                    {% assign healing_benefits = 'Protection | Strength | Self-Control' %}
                  {% elsif product_title_downcase contains 'green aventurine' or product_title_downcase contains 'aventurine' %}
                    {% assign healing_benefits = 'Stone Of Opportunities | Attracts Luck | Growth' %}
                  {% elsif product_title_downcase contains 'sulemani hakik' or product_title_downcase contains 'sulaimani' %}
                    {% assign healing_benefits = 'Protection | Balance | Power' %}
                  {% elsif product_title_downcase contains 'carnelian' %}
                    {% assign healing_benefits = 'Strength | Creativity | Ambition' %}
                  {% elsif product_title_downcase contains "hawk's eye" or product_title_downcase contains 'hawks eye' or product_title_downcase contains 'hawk eye' %}
                    {% assign healing_benefits = 'Vision | Strength | Stability' %}
                  {% elsif product_title_downcase contains 'selenite' %}
                    {% assign healing_benefits = 'Cleanse | Purify | Protect' %}
                  {% elsif product_title_downcase contains 'sodalite' %}
                    {% assign healing_benefits = 'Clarity | Confidence | Communication' %}
                  {% elsif product_title_downcase contains 'sunstone' %}
                    {% assign healing_benefits = 'Joy | Confidence | Success' %}
                  {% elsif product_title_downcase contains "cat's eye" or product_title_downcase contains 'cats eye' or product_title_downcase contains 'cat eye' %}
                    {% assign healing_benefits = 'Shield | Strength | Success' %}
                  {% elsif product_title_downcase contains 'agate' %}
                    {% assign healing_benefits = 'Balance | Harmony | Protection' %}
                  {% elsif product_title_downcase contains 'malachite' %}
                    {% assign healing_benefits = 'Transformation | Growth | Protection' %}
                  {% elsif product_title_downcase contains 'peridot' %}
                    {% assign healing_benefits = 'Growth | Healing | Prosperity' %}
                  {% elsif product_title_downcase contains 'topaz' %}
                    {% assign healing_benefits = 'Love | Passion | Creativity' %}
                  {% elsif product_title_downcase contains 'tourmaline' %}
                    {% assign healing_benefits = 'Protection | Balance | Healing' %}
                  {% else %}
                    {% assign healing_benefits = 'Positive Energy | Healing | Balance' %}
                  {% endif %}

                  {% assign bracelet_info = healing_benefits %}
                {% endif %}

                {%- if show_zodiac -%}
                    <div class="product-subheading card-subheading zodiac-subheading">
                        {{ zodiac_dates }}
                    </div>
                {% elsif show_bracelet_info and bracelet_info != blank %}
                    <div class="product-subheading card-subheading bracelet-subheading">
                        {{ bracelet_info }}
                    </div>
                {%- elsif product.metafields.custom.subheading != blank -%}
                    <div class="card-subheading">
                        {{ product.metafields.custom.subheading }}
                    </div>
                {%- endif -%}
                <div class="card-price">
                    {% render 'price',
                        product: product,
                        price_class: ''
                    %}
                </div>
            </div>
        </div>
    </div>
</div>
